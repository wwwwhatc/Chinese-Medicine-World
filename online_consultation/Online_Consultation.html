<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âú®Á∫øÈóÆËØäÂπ≥Âè∞</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Ëá™ÂÆö‰πâÊ†∑Âºè */
        body {
            background-color: #f7f9fc;
            color: #333;
        }
        .sidebar {
            min-height: 100vh;
        }
        .sidebar .nav-link.active {
            background-color: #556B2F;
            color: white;
        }
        .doctor-card img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 1rem;
        }
        .modal-header .close {
            border: none;
            background: none;
        }
    </style>
</head>
<body>
    <div class="d-flex">
        <!-- ‰æßËæπÊ†è -->
        <nav class="sidebar bg-success text-white p-4 flex-shrink-0">
            <div class="mb-4 text-center fs-4 fw-bold">Âú®Á∫øÈóÆËØä</div>
            <ul class="nav nav-pills flex-column mb-auto">
                <li class="nav-item">
                    <a href="Online_Consultation1.html" class="nav-link text-white" aria-current="page">
                        AIÊô∫ËÉΩÈóÆËØä
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#doctor-section" class="nav-link text-white">
                        ÈÄâÊã©ÂåªÁîü
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#records-section" class="nav-link text-white">
                        È¢ÑÁ∫¶ËÆ∞ÂΩï
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/Chinese-Medicine-World/home/home.html" class="nav-link text-white">
                        ËøîÂõûÈ¶ñÈ°µ
                    </a>
                </li>
            </ul>
        </nav>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
        <div class="flex-grow-1 p-4">
            <!-- ‰∏ªÂ§¥ÈÉ® -->
            <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
                <h1 class="mb-3">Ê¨¢Ëøé‰ΩøÁî®Âú®Á∫øÈóÆËØäÂπ≥Âè∞</h1>
                <div class="position-relative">
                    <input type="text" id="search-input" class="form-control rounded-pill" placeholder="ÊêúÁ¥¢ÂåªÁîüÊàñÁßëÂÆ§...">
                    <span class="position-absolute top-50 end-0 translate-middle-y me-3">üîç</span>
                </div>
            </div>

            <!-- ÂåªÁîüÂàóË°® -->
            <section id="doctor-section" class="mb-5">
                <h2 class="mb-4 text-center">ÈÄâÊã©ÂåªÁîü</h2>
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    <!-- ÂåªÁîüÂç°ÁâáÁ§∫‰æã -->
                    <div class="col">
                        <div class="card doctor-card h-100 text-center">
                            <img src="img/doctor1.jpg" class="card-img-top mx-auto mt-3" alt="ÊùéÂåªÁîü" style="width:100px; height:100px;">
                            <div class="card-body">
                                <h5 class="card-title">ÊùéÂåªÁîü</h5>
                                <p class="card-text">‰∏≠ÂåªÂÜÖÁßë‰∏ìÂÆ∂</p>
                                <button class="btn btn-success reserve-btn">È¢ÑÁ∫¶</button>
                            </div>
                        </div>
                    </div>
                    <!-- ÂÖ∂‰ªñÂåªÁîüÂç°Áâá... -->
                    <div class="col">
                        <div class="card doctor-card h-100 text-center">
                            <img src="img/doctor2.jpg" class="card-img-top mx-auto mt-3" alt="ÁéãÂåªÁîü" style="width:100px; height:100px;">
                            <div class="card-body">
                                <h5 class="card-title">ÁéãÂåªÁîü</h5>
                                <p class="card-text">ÈíàÁÅ∏‰∏éÊé®Êãø‰∏ìÂÆ∂</p>
                                <button class="btn btn-success reserve-btn">È¢ÑÁ∫¶</button>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card doctor-card h-100 text-center">
                            <img src="img/doctor3.jpg" class="card-img-top mx-auto mt-3" alt="ËµµÂåªÁîü" style="width:100px; height:100px;">
                            <div class="card-body">
                                <h5 class="card-title">ËµµÂåªÁîü</h5>
                                <p class="card-text">‰∏≠ÂåªÂ¶áÁßë‰∏ìÂÆ∂</p>
                                <button class="btn btn-success reserve-btn">È¢ÑÁ∫¶</button>
                            </div>
                        </div>
                    </div>
                    <!-- Êñ∞Â¢ûÂåªÁîüÂç°Áâá -->
                    <div class="col">
                        <div class="card doctor-card h-100 text-center">
                            <img src="img/doctor4.jpg" class="card-img-top mx-auto mt-3" alt="Â≠ôÂåªÁîü" style="width:100px; height:100px;">
                            <div class="card-body">
                                <h5 class="card-title">Â≠ôÂåªÁîü</h5>
                                <p class="card-text">‰∏≠ÂåªÂÑøÁßë‰∏ìÂÆ∂</p>
                                <button class="btn btn-success reserve-btn">È¢ÑÁ∫¶</button>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card doctor-card h-100 text-center">
                            <img src="img/doctor5.jpg" class="card-img-top mx-auto mt-3" alt="Âë®ÂåªÁîü" style="width:100px; height:100px;">
                            <div class="card-body">
                                <h5 class="card-title">Âë®ÂåªÁîü</h5>
                                <p class="card-text">‰∏≠ÂåªÈ™®Áßë‰∏ìÂÆ∂</p>
                                <button class="btn btn-success reserve-btn">È¢ÑÁ∫¶</button>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card doctor-card h-100 text-center">
                            <img src="img/doctor6.jpg
                            " class="card-img-top mx-auto mt-3" alt="Âê¥ÂåªÁîü" style="width:100px; height:100px;">
                            <div class="card-body">
                                <h5 class="card-title">Âê¥ÂåªÁîü</h5>
                                <p class="card-text">‰∏≠ÂåªÁöÆËÇ§Áßë‰∏ìÂÆ∂</p>
                                <button class="btn btn-success reserve-btn">È¢ÑÁ∫¶</button>
                            </div>
                        </div>
                    </div>
                    <!-- ÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÁªßÁª≠Ê∑ªÂä†Êõ¥Â§öÂåªÁîüÂç°Áâá -->
                </div>
            </section>

            <!-- È¢ÑÁ∫¶ËÆ∞ÂΩï -->
            <section id="records-section" class="mb-5">
                <h2 class="mb-4 text-center">È¢ÑÁ∫¶ËÆ∞ÂΩï</h2>
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="records-table">
                        <thead class="table-success">
                            <tr>
                                <th scope="col">Êó•Êúü</th>
                                <th scope="col">ÂåªÁîü</th>
                                <th scope="col">ÁßëÂÆ§</th>
                                <th scope="col">Áä∂ÊÄÅ</th>
                                <th scope="col">Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- È¢ÑÁ∫¶ËÆ∞ÂΩïÂ∞ÜÂä®ÊÄÅÊ∑ªÂä†Âà∞ËøôÈáå -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- È¢ÑÁ∫¶Ê®°ÊÄÅÁ™óÂè£ -->
        <div class="modal fade" id="reserve-modal" tabindex="-1" aria-labelledby="reserveModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="reserveModalLabel">È¢ÑÁ∫¶ÂåªÁîü</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ÂÖ≥Èó≠"></button>
                    </div>
                    <div class="modal-body">
                        <form id="reserve-form">
                            <div class="mb-3">
                                <label for="doctor-name" class="form-label">ÂåªÁîüÂßìÂêç:</label>
                                <input type="text" id="doctor-name" name="doctor-name" class="form-control" readonly>
                            </div>
                            <div class="mb-3">
                                <label for="appointment-date" class="form-label">È¢ÑÁ∫¶Êó•Êúü:</label>
                                <input type="date" id="appointment-date" name="appointment-date" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-success">Á°ÆËÆ§È¢ÑÁ∫¶</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÁºñËæëÊ®°ÊÄÅÁ™óÂè£ -->
        <div class="modal fade" id="edit-modal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editModalLabel">ÁºñËæëÈ¢ÑÁ∫¶</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ÂÖ≥Èó≠"></button>
                    </div>
                    <div class="modal-body">
                        <form id="edit-form">
                            <div class="mb-3">
                                <label for="edit-date" class="form-label">È¢ÑÁ∫¶Êó•Êúü:</label>
                                <input type="date" id="edit-date" name="edit-date" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-primary">‰øùÂ≠ò‰øÆÊîπ</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS Âíå‰æùËµñÈ°πÔºàPopperÔºâ -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- JavaScript ÂÆûÁé∞È¢ÑÁ∫¶‰∏éÂà†Èô§ÂäüËÉΩ -->
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const reserveButtons = document.querySelectorAll('.reserve-btn');
                const recordsTableBody = document.querySelector('#records-table tbody');
                const reserveModal = new bootstrap.Modal(document.getElementById('reserve-modal'));
                const editModal = new bootstrap.Modal(document.getElementById('edit-modal'));
                const reserveForm = document.getElementById('reserve-form');
                const editForm = document.getElementById('edit-form');
                const doctorNameInput = document.getElementById('doctor-name');
                const appointmentDateInput = document.getElementById('appointment-date');
                const editDateInput = document.getElementById('edit-date');
                let appointments = JSON.parse(localStorage.getItem('appointments')) || [];
                let currentEditIndex = null;

                // Âä†ËΩΩÈ¢ÑÁ∫¶ËÆ∞ÂΩïÔºà‰ªé localStorageÔºâ
                appointments.forEach(app => addAppointmentToTable(app, false));
                updateAppointmentStatus();

                // ÁªëÂÆöÈ¢ÑÁ∫¶ÊåâÈíÆ‰∫ã‰ª∂
                reserveButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const doctorCard = button.closest('.doctor-card');
                        const doctorName = doctorCard.querySelector('.card-title').textContent;
                        const department = doctorCard.querySelector('.card-text').textContent;

                        // ÊâìÂºÄÈ¢ÑÁ∫¶Ê®°ÊÄÅÁ™óÂè£
                        doctorNameInput.value = doctorName;
                        appointmentDateInput.value = '';
                        reserveModal.show();
                    });
                });

                // È¢ÑÁ∫¶Ë°®ÂçïÊèê‰∫§‰∫ã‰ª∂
                reserveForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const doctorName = doctorNameInput.value.trim();
                    const department = getDepartmentByDoctorName(doctorName);
                    const date = appointmentDateInput.value;

                    if (!date) {
                        alert('ËØ∑ÈÄâÊã©È¢ÑÁ∫¶Êó•Êúü„ÄÇ');
                        return;
                    }

                    const selectedDate = new Date(date);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    if (selectedDate < today) {
                        alert('È¢ÑÁ∫¶Êó•ÊúüÂøÖÈ°ªÊòØ‰ªäÂ§©ÊàñÊú™Êù•ÁöÑÊó•Êúü„ÄÇ');
                        return;
                    }

                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊúâÈáçÂ§çÈ¢ÑÁ∫¶
                    const duplicate = appointments.some(app => app.doctor === doctorName && app.date === date);
                    if (duplicate) {
                        alert('ÊÇ®Â∑≤ÁªèÂú®Ëøô‰∏ÄÂ§©È¢ÑÁ∫¶‰∫ÜËØ•ÂåªÁîü„ÄÇ');
                        return;
                    }

                    // ÂàõÂª∫È¢ÑÁ∫¶ÂØπË±°
                    const appointment = {
                        date,
                        doctor: doctorName,
                        department,
                        status: 'ÂæÖÁ°ÆËÆ§'
                    };

                    // Ê∑ªÂä†Âà∞È¢ÑÁ∫¶ËÆ∞ÂΩïÊï∞ÁªÑ
                    appointments.push(appointment);
                    // ‰øùÂ≠òÂà∞ localStorage
                    localStorage.setItem('appointments', JSON.stringify(appointments));
                    // Ê∑ªÂä†Âà∞Ë°®Ê†º
                    addAppointmentToTable(appointment, true);

                    // ÂÖ≥Èó≠Ê®°ÊÄÅÁ™óÂè£
                    reserveModal.hide();
                });

                // ÁºñËæëË°®ÂçïÊèê‰∫§‰∫ã‰ª∂
                editForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const newDate = editDateInput.value;

                    if (!newDate) {
                        alert('ËØ∑ÈÄâÊã©È¢ÑÁ∫¶Êó•Êúü„ÄÇ');
                        return;
                    }

                    const selectedDate = new Date(newDate);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    if (selectedDate < today) {
                        alert('È¢ÑÁ∫¶Êó•ÊúüÂøÖÈ°ªÊòØ‰ªäÂ§©ÊàñÊú™Êù•ÁöÑÊó•Êúü„ÄÇ');
                        return;
                    }

                    const appointment = appointments[currentEditIndex];
                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊúâÈáçÂ§çÈ¢ÑÁ∫¶
                    const duplicate = appointments.some((app, index) => app.doctor === appointment.doctor && app.date === newDate && index !== currentEditIndex);
                    if (duplicate) {
                        alert('ÊÇ®Â∑≤ÁªèÂú®Ëøô‰∏ÄÂ§©È¢ÑÁ∫¶‰∫ÜËØ•ÂåªÁîü„ÄÇ');
                        return;
                    }

                    // Êõ¥Êñ∞È¢ÑÁ∫¶Êó•Êúü
                    appointment.date = newDate;

                    // Êõ¥Êñ∞ localStorage
                    localStorage.setItem('appointments', JSON.stringify(appointments));

                    // Êõ¥Êñ∞Ë°®Ê†º
                    updateTableRow(currentEditIndex, appointment);

                    // ÂÖ≥Èó≠Ê®°ÊÄÅÁ™óÂè£
                    editModal.hide();
                });

                // ÂáΩÊï∞ÔºöËé∑ÂèñÁßëÂÆ§‰ø°ÊÅØÈÄöËøáÂåªÁîüÂßìÂêç
                function getDepartmentByDoctorName(name) {
                    const card = document.querySelector(`.doctor-card .card-title[text="${name}"]`);
                    const cardElement = Array.from(document.querySelectorAll('.doctor-card')).find(card => card.querySelector('.card-title').textContent === name);
                    return cardElement ? cardElement.querySelector('.card-text').textContent : '';
                }

                // ÂáΩÊï∞ÔºöÊ∑ªÂä†È¢ÑÁ∫¶Âà∞Ë°®Ê†º
                function addAppointmentToTable(appointment, saveToLocal = true) {
                    const tr = document.createElement('tr');

                    const tdDate = document.createElement('td');
                    tdDate.textContent = appointment.date;
                    tr.appendChild(tdDate);

                    const tdDoctor = document.createElement('td');
                    tdDoctor.textContent = appointment.doctor;
                    tr.appendChild(tdDoctor);

                    const tdDepartment = document.createElement('td');
                    tdDepartment.textContent = appointment.department;
                    tr.appendChild(tdDepartment);

                    const tdStatus = document.createElement('td');
                    tdStatus.textContent = appointment.status;
                    tr.appendChild(tdStatus);

                    const tdAction = document.createElement('td');

                    // ÁºñËæëÊåâÈíÆ
                    const editBtn = document.createElement('button');
                    editBtn.textContent = 'ÁºñËæë';
                    editBtn.classList.add('btn', 'btn-primary', 'btn-sm', 'me-2');
                    editBtn.addEventListener('click', () => {
                        currentEditIndex = appointments.indexOf(appointment);
                        editDateInput.value = appointment.date;
                        editModal.show();
                    });
                    tdAction.appendChild(editBtn);

                    // Âà†Èô§ÊåâÈíÆ
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'Âà†Èô§';
                    deleteBtn.classList.add('btn', 'btn-danger', 'btn-sm');
                    deleteBtn.addEventListener('click', () => {
                        if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°È¢ÑÁ∫¶ËÆ∞ÂΩïÂêóÔºü')) {
                            // ÁßªÈô§È¢ÑÁ∫¶ËÆ∞ÂΩï
                            recordsTableBody.removeChild(tr);
                            // Êõ¥Êñ∞ appointments Êï∞ÁªÑ
                            appointments = appointments.filter(app => !(app.date === appointment.date && app.doctor === appointment.doctor));
                            // Êõ¥Êñ∞ localStorage
                            localStorage.setItem('appointments', JSON.stringify(appointments));
                        }
                    });
                    tdAction.appendChild(deleteBtn);

                    tr.appendChild(tdAction);

                    recordsTableBody.appendChild(tr);
                }

                // ÂáΩÊï∞ÔºöÊõ¥Êñ∞Ë°®Ê†ºË°å
                function updateTableRow(index, appointment) {
                    const tr = recordsTableBody.children[index];
                    if (tr) {
                        tr.children[0].textContent = appointment.date;
                        tr.children[1].textContent = appointment.doctor;
                        tr.children[2].textContent = appointment.department;
                        tr.children[3].textContent = appointment.status;
                    }
                }

                // ÂáΩÊï∞ÔºöÊõ¥Êñ∞È¢ÑÁ∫¶Áä∂ÊÄÅ
                function updateAppointmentStatus() {
                    const today = new Date().toISOString().split('T')[0];
                    appointments.forEach((app, index) => {
                        if (app.date < today && app.status === 'ÂæÖÁ°ÆËÆ§') {
                            app.status = 'Â∑≤ÂÆåÊàê';
                            updateTableRow(index, app);
                        }
                    });
                    localStorage.setItem('appointments', JSON.stringify(appointments));
                }

                // ÊêúÁ¥¢ÂäüËÉΩÔºàÂ∏¶Èò≤ÊäñÔºâ
                const searchInput = document.getElementById('search-input');
                let debounceTimeout;
                searchInput.addEventListener('input', () => {
                    clearTimeout(debounceTimeout);
                    debounceTimeout = setTimeout(() => {
                        const query = searchInput.value.toLowerCase();
                        const doctorCards = document.querySelectorAll('.doctor-card');
                        doctorCards.forEach(card => {
                            const name = card.querySelector('.card-title').textContent.toLowerCase();
                            const department = card.querySelector('.card-text').textContent.toLowerCase();
                            if (name.includes(query) || department.includes(query)) {
                                card.parentElement.style.display = 'block';
                            } else {
                                card.parentElement.style.display = 'none';
                            }
                        });
                    }, 300);
                });
            });
        </script>
    </body>
</html>
